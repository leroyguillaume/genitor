version: '3.4'

services:
  agent:
    image: genitor/agent
    hostname: agent-01
    environment:
      GENITOR_PROFILE: dev
      GENITOR_KAFKA_BOOTSTRAP_SERVERS: broker:9093
      GENITOR_KAFKA_SSL_KEYSTORE: /etc/ssl/genitor/kafka.client.keystore.jks
      GENITOR_KAFKA_SSL_KEYSTORE_PASSWORD: changeit
      GENITOR_KAFKA_SSL_TRUSTSTORE: /etc/ssl/genitor/kafka.client.truststore.jks
      GENITOR_KAFKA_SSL_TRUSTSTORE_PASSWORD: changeit
    ports:
      - 2010:2010
    volumes:
      - ./docker/kafka/ssl:/etc/ssl/genitor
  broker:
    build:
      context: docker/kafka
      target: kafka
    environment:
      ZOOKEEPER_CONNECT: zookeeper:2181
    ports:
      - 9092:9092
      - 9093:9093
  master:
    image: genitor/master
    depends_on:
      - db
    environment:
      GENITOR_PROFILE: dev
      GENITOR_DB_HOST: db
      GENITOR_KAFKA_BOOTSTRAP_SERVERS: broker:9093
      GENITOR_KAFKA_SSL_KEYSTORE: /etc/ssl/genitor/kafka.client.keystore.jks
      GENITOR_KAFKA_SSL_KEYSTORE_PASSWORD: changeit
      GENITOR_KAFKA_SSL_TRUSTSTORE: /etc/ssl/genitor/kafka.client.truststore.jks
      GENITOR_KAFKA_SSL_TRUSTSTORE_PASSWORD: changeit
    ports:
      - 2001:2001
    volumes:
      - ./docker/kafka/ssl:/etc/ssl/genitor
  db:
    image: postgres:11
    environment:
      POSTGRES_DB: genitor_master
      POSTGRES_USER: genitor_master
      POSTGRES_PASSWORD: genitor_master
    ports:
      - 5432:5432
  zookeeper:
    build:
      context: docker/kafka
      target: zookeeper
    ports:
      - 2181:2181
